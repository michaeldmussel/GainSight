<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout CSV Parser Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #2980b9;
            background-color: #ecf0f1;
        }
        
        .upload-area.dragover {
            border-color: #27ae60;
            background-color: #d5f4e6;
        }
        
        input[type="file"] {
            display: none;
        }
        
        .upload-btn {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }
        
        .upload-btn:hover {
            background: #2980b9;
        }
        
        .results {
            display: none;
        }
        
        .section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .section h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .exercise-list {
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border-radius: 5px;
            padding: 10px;
        }
        
        .exercise-item {
            padding: 8px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            transition: width 0.3s ease;
        }
        
        .json-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
        
        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 2px;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèãÔ∏è Workout CSV Parser</h1>
        
        <div class="upload-area" id="uploadArea">
            <h3>üìÅ Upload your workout CSV file</h3>
            <p>Drag and drop your CSV file here or click to browse</p>
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                Choose File
            </button>
            <input type="file" id="fileInput" accept=".csv" />
        </div>
        
        <div id="loadingIndicator" class="loading" style="display: none;">
            <p>üîÑ Parsing your workout data...</p>
        </div>
        
        <div id="errorMessage" class="error" style="display: none;"></div>
        <div id="successMessage" class="success" style="display: none;"></div>
        
        <div class="results" id="results">
            <div class="tabs">
                <button class="tab active" onclick="showTab('summary')">üìä Summary</button>
                <button class="tab" onclick="showTab('exercises')">üí™ Exercises</button>
                <button class="tab" onclick="showTab('sessions')">‚è±Ô∏è Sessions</button>
                <button class="tab" onclick="showTab('progress')">üìà Progress</button>
                <button class="tab" onclick="showTab('raw')">üîß Raw Data</button>
            </div>
            
            <div id="summaryTab" class="tab-content active">
                <div class="section">
                    <h3>üìà Workout Statistics</h3>
                    <div class="stats-grid" id="statsGrid">
                        <!-- Stats will be populated here -->
                    </div>
                </div>
                
                <div class="section">
                    <h3>üéØ Personal Records</h3>
                    <div id="personalRecords">
                        <!-- Personal records will be populated here -->
                    </div>
                </div>
            </div>
            
            <div id="exercisesTab" class="tab-content">
                <div class="section">
                    <h3>üèÉ Exercise Library</h3>
                    <div class="exercise-list" id="exerciseList">
                        <!-- Exercise list will be populated here -->
                    </div>
                </div>
                
                <div class="section">
                    <h3>üéØ Exercises by Body Part</h3>
                    <div id="bodyPartExercises">
                        <!-- Body part exercises will be populated here -->
                    </div>
                </div>
            </div>
            
            <div id="sessionsTab" class="tab-content">
                <div class="section">
                    <h3>üìÖ Recent Workout Sessions</h3>
                    <div id="sessionsList">
                        <!-- Sessions will be populated here -->
                    </div>
                </div>
            </div>
            
            <div id="progressTab" class="tab-content">
                <div class="section">
                    <h3>üìä Progress Tracking</h3>
                    <div id="progressCharts">
                        <!-- Progress charts will be populated here -->
                    </div>
                </div>
            </div>
            
            <div id="rawTab" class="tab-content">
                <div class="section">
                    <h3>üîß Raw Parsed Data (JSON)</h3>
                    <div class="json-output" id="jsonOutput">
                        <!-- JSON data will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="workout-parser.js"></script>
    <script>
        let parsedData = null;
        let analyzer = null;

        // File upload handling
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const results = document.getElementById('results');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');

        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (!file.name.endsWith('.csv')) {
                showError('Please select a CSV file.');
                return;
            }

            showLoading(true);
            hideMessages();

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const csvContent = e.target.result;
                    parseWorkoutData(csvContent);
                } catch (error) {
                    showError('Error reading file: ' + error.message);
                    showLoading(false);
                }
            };
            reader.readAsText(file);
        }

        function parseWorkoutData(csvContent) {
            try {
                const parser = new WorkoutParser();
                parsedData = parser.parse(csvContent);
                analyzer = new WorkoutAnalyzer(parsedData);
                
                showLoading(false);
                showSuccess('Workout data parsed successfully! Found ' + 
                    parsedData.workoutSessions.length + ' workout sessions and ' + 
                    parsedData.exercises.length + ' exercise entries.');
                
                displayResults();
                results.style.display = 'block';
            } catch (error) {
                showError('Error parsing CSV: ' + error.message);
                showLoading(false);
            }
        }

        function displayResults() {
            displaySummary();
            displayExercises();
            displaySessions();
            displayProgress();
            displayRawData();
        }

        function displaySummary() {
            const summary = parsedData;
            const parser = new WorkoutParser();
            parser.data = parsedData; // Set the data
            const stats = parser.getSummary();
            
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.totalWorkouts}</div>
                    <div class="stat-label">Total Workouts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.totalExercises}</div>
                    <div class="stat-label">Exercise Entries</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.totalSets}</div>
                    <div class="stat-label">Total Sets</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Math.round(stats.totalVolume).toLocaleString()}</div>
                    <div class="stat-label">Total Volume (kg√óreps)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.avgWorkoutTime}</div>
                    <div class="stat-label">Avg Workout Time (min)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.exerciseTypes.length}</div>
                    <div class="stat-label">Unique Exercises</div>
                </div>
            `;

            // Display personal records
            const records = analyzer.getPersonalRecords();
            const recordsContainer = document.getElementById('personalRecords');
            const recordsHtml = Object.keys(records).slice(0, 10).map(exercise => {
                const record = records[exercise];
                return `
                    <div class="exercise-item">
                        <span><strong>${exercise}</strong></span>
                        <span>${record.weight}kg √ó ${record.reps} reps</span>
                    </div>
                `;
            }).join('');
            recordsContainer.innerHTML = recordsHtml || '<p>No personal records found.</p>';
        }

        function displayExercises() {
            const exerciseList = document.getElementById('exerciseList');
            const exercises = parsedData.exercises.slice(0, 50); // Show first 50
            
            const exercisesHtml = exercises.map(exercise => `
                <div class="exercise-item">
                    <div>
                        <strong>${exercise.exercisename || 'Unknown Exercise'}</strong>
                        <br>
                        <small>${exercise.TIMESTAMP || 'No date'}</small>
                    </div>
                    <div>
                        ${exercise.sets ? exercise.sets.length + ' sets' : 'No sets'}
                        <br>
                        <small>${exercise.totalVolume ? Math.round(exercise.totalVolume) + ' volume' : ''}</small>
                    </div>
                </div>
            `).join('');
            
            exerciseList.innerHTML = exercisesHtml || '<p>No exercises found.</p>';

            // Display exercises by body part
            const parser = new WorkoutParser();
            parser.data = parsedData;
            const bodyPartExercises = parser.getExercisesByBodyPart();
            const bodyPartContainer = document.getElementById('bodyPartExercises');
            
            const bodyPartHtml = Object.keys(bodyPartExercises).map(bodyPart => `
                <div class="stat-card">
                    <h4>${getBodyPartName(bodyPart)}</h4>
                    <div class="stat-number">${bodyPartExercises[bodyPart].length}</div>
                    <div class="stat-label">exercises</div>
                </div>
            `).join('');
            
            bodyPartContainer.innerHTML = bodyPartHtml;
        }

        function displaySessions() {
            const sessionsList = document.getElementById('sessionsList');
            const sessions = parsedData.workoutSessions.slice(0, 20); // Show last 20
            
            const sessionsHtml = sessions.map(session => `
                <div class="exercise-item">
                    <div>
                        <strong>Workout ${session._id}</strong>
                        <br>
                        <small>${new Date(session.starttime * 1000).toLocaleDateString()}</small>
                    </div>
                    <div>
                        ${Math.round(session.total_time / 60)} min total
                        <br>
                        <small>${session.total_exercise} exercises</small>
                    </div>
                </div>
            `).join('');
            
            sessionsList.innerHTML = sessionsHtml || '<p>No workout sessions found.</p>';
        }

        function displayProgress() {
            const progressContainer = document.getElementById('progressCharts');
            const consistency = analyzer.getWorkoutConsistency();
            
            if (consistency) {
                progressContainer.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${consistency.averageGap}</div>
                            <div class="stat-label">Avg days between workouts</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${consistency.minGap}</div>
                            <div class="stat-label">Shortest gap (days)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${consistency.maxGap}</div>
                            <div class="stat-label">Longest gap (days)</div>
                        </div>
                    </div>
                `;
            } else {
                progressContainer.innerHTML = '<p>Not enough data to calculate consistency metrics.</p>';
            }
        }

        function displayRawData() {
            const jsonOutput = document.getElementById('jsonOutput');
            jsonOutput.textContent = JSON.stringify(parsedData, null, 2);
        }

        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function getBodyPartName(bodyPart) {
            const bodyPartMap = {
                '0': 'Back',
                '1': 'Back',
                '2': 'Biceps', 
                '3': 'Chest',
                '6': 'Shoulders',
                '7': 'Triceps',
                '8': 'Legs',
                '9': 'Calves',
                '10': 'Cardio'
            };
            return bodyPartMap[bodyPart] || 'Unknown';
        }

        function showLoading(show) {
            loadingIndicator.style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.style.display = 'block';
        }

        function hideMessages() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
        }
    </script>
</body>
</html>
